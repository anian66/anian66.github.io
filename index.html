<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meow</title>
    <!-- å¼•å…¥ Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* å¯¼å…¥ Inter å­—ä½“ */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900;display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* æµ…ç°è‰²èƒŒæ™¯ */
            min-height: 100vh;
            overflow: hidden; 
        }

        /* é”å±ç•Œé¢ç‰¹æœ‰çš„åŠ¨ç”»æŒ‡é’ˆ */
        .bounce-arrow {
            animation: bounce 2s infinite;
        }
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {
                transform: translateY(0);
            }
            40% {
                transform: translateY(-20px);
            }
            60% {
                transform: translateY(-10px);
            }
        }

        /* Horizontal Unlock Slider Styles */
        .unlock-area {
            position: relative;
            width: 300px;
            height: 60px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 30px;
            overflow: hidden;
            user-select: none;
            -webkit-user-select: none;
        }

        .unlock-handle {
            position: absolute;
            top: 0;
            left: 0;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #00bfff, #0078ff);
            border-radius: 50%;
            transition: left 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* æ¨¡æ‹Ÿæ‰‹æœºå£çº¸ */
        #main-content {
            background-image: url('https://placehold.co/480x1000/374151/ffffff/png?text=Mobile+Wallpaper');
            background-size: cover;
            background-position: center;
        }
        
        /* éšè—æ»šåŠ¨æ¡ä½†ä¿ç•™æ»šåŠ¨åŠŸèƒ½ */
        .app-grid-area::-webkit-scrollbar {
            display: none;
        }
        .app-grid-area {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }
        
        /* æŒ‰é’®æŒ‰å‹æ•ˆæœåŸºç±» */
        .app-icon-btn, .dock-icon-btn, .toggle-btn {
            transition: transform 0.1s ease-out;
            touch-action: manipulation; /* ä¼˜åŒ–ç§»åŠ¨ç«¯è§¦æ‘¸å“åº” */
        }
        .app-icon-btn:active, .dock-icon-btn:active, .toggle-btn:active {
            transform: scale(0.9);
        }

        /* NEW: Jiggle Keyframe for Edit Mode */
        @keyframes jiggle {
            0% { transform: rotate(0deg) scale(1); }
            15% { transform: rotate(-1deg) scale(1.02); }
            30% { transform: rotate(1deg) scale(1.02); }
            45% { transform: rotate(0deg) scale(1); }
            60% { transform: rotate(-1deg) scale(1.02); }
            75% { transform: rotate(1deg) scale(1.02); }
            100% { transform: rotate(0deg) scale(1); }
        }

        .jiggle {
            animation: jiggle 0.35s infinite ease-in-out alternate;
            cursor: grab;
        }

        /* ç»Ÿä¸€ App å¯åŠ¨çš„æ¨¡æ€æ¡†åŠ¨ç”» */
        .app-modal { 
            /* ADDED w-full h-full for explicit sizing */
            width: 100%;
            height: 100%;
            transition: transform 0.25s ease-in-out; 
            transform: translateY(100%); /* åˆå§‹çŠ¶æ€åœ¨å±å¹•å¤– */
        }
        .app-modal.is-open { 
            transform: translateY(0);
        }

        /* Bluetooth Bottom Sheet (åº•éƒ¨æ“ä½œé¢æ¿) - ä¼˜åŒ–æ—¶é•¿å’Œæ›²çº¿ */
        #bluetooth-config-modal {
            transition: transform 0.25s ease-in-out;
            transform: translateY(100%); /* åˆå§‹çŠ¶æ€åœ¨å±å¹•å¤– */
        }
        #bluetooth-config-modal.is-open {
            transform: translateY(0);
        }
        
        /* é€šçŸ¥ä¸­å¿ƒåŠ¨ç”» - ä¼˜åŒ–æ—¶é•¿å’Œæ›²çº¿ */
        #notification-center {
            /* ADDED w-full h-full for explicit sizing */
            width: 100%;
            height: 100%;
            transition: transform 0.25s ease-in-out;
            transform: translateY(-100%); /* åˆå§‹çŠ¶æ€åœ¨å±å¹•å¤–ä¸Šæ–¹ */
        }
        
        /* ==== NEW VIRTUAL STATUS BAR STYLES ==== */
        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 6px 14px;
            background: rgba(255, 255, 255, 0.08);
            color: #fff;
            font-family: "Inter", "PingFang SC", sans-serif;
            font-size: 14px;
            letter-spacing: 0.5px;
            backdrop-filter: blur(10px);
            border-radius: 10px;
            user-select: none;
        }

        .status-left,
        .status-right {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 13px;
        }

        .status-weather::before {
            content: "â˜ï¸ "; /* Cloud icon for weather */
        }

        .status-network::before {
            content: "ğŸ“¶ "; /* Signal icon for network */
        }

        .status-battery::before {
            content: "ğŸ”‹ "; /* Battery icon for battery */
        }
        /* ==== END NEW VIRTUAL STATUS BAR STYLES ==== */
    </style>
</head>
<body>

    <!-- 1. Outer Centering Container -->
    <div class="flex items-center justify-center min-h-screen p-4 bg-gray-200">
        
        <!-- 2. æ‰‹æœºæ¡†æ¶ (Phone Frame) - çº¦æŸå°ºå¯¸å’Œæ¯”ä¾‹ -->
        <div id="phone-frame"
             class="relative shadow-2xl rounded-[2rem] bg-gray-900 overflow-hidden"
             style="
                 width: min(95vw, 420px);
                 height: min(90vh, 800px);
                 max-width: 480px;
                 max-height: 900px;
                 padding: 6px;
                 display: flex;
                 align-items: stretch;
                 justify-content: center;
             ">
             <!-- è‡ªé€‚åº”å®‰å“æ ·å¼æ‰‹æœºæ¡†æ¶ -->

            <!-- 3. æ‰‹æœºå±å¹•æ˜¾ç¤ºåŒº - ç¡®ä¿å†…å®¹å’Œé”å±å±‚å¡«å……æ»¡è¿™ä¸ªåŒºåŸŸ -->
            <div id="inner-screen" class="absolute inset-0 rounded-[2.7rem] overflow-hidden bg-white">

                <!-- Main Content Container (Home Screen) -->
                <div id="main-content" 
                     class="w-full h-full transition-all duration-500 ease-in-out flex flex-col p-2" 
                     style="transform: scale(0.95); filter: blur(2px);">
                    
                    <!-- A. Status Bar (çŠ¶æ€æ : å®æ—¶åŒæ­¥) - REPLACED WITH NEW HTML -->
                    <div class="status-bar flex-shrink-0 mx-2">
                        <div class="status-left">
                            <span class="status-time">--:--</span>
                            <span class="status-weather">--Â°C</span>
                        </div>
                        <div class="status-right">
                            <span class="status-network">--</span>
                            <span class="status-battery">--%</span>
                        </div>
                    </div>
                    <!-- END REPLACED STATUS BAR -->
                    
                    <!-- NEW: Weather/Time/Location Widget (ç½®é¡¶æ˜¾ç¤º) -->
                    <div id="time-weather-widget" class="flex-shrink-0 mt-4 mx-4 p-5 bg-white/10 backdrop-blur-md rounded-3xl text-white shadow-xl">
                        <div class="flex items-center justify-between">
                            <!-- Left: Clock -->
                            <div>
                                <span id="widget-time" class="text-6xl font-extrabold leading-none">10:16</span>
                                <span id="widget-date" class="block text-sm font-medium text-gray-300 mt-1">å‘¨å››, 10æœˆ23æ—¥</span>
                            </div>
                            <!-- Right: Weather/Location -->
                            <div class="text-right">
                                <!-- ADDED ID for real-time temperature sync -->
                                <p class="text-3xl font-bold" id="widget-temp-display">22Â°C</p>
                                <div class="flex items-center justify-end text-sm text-gray-300 mt-1">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 mr-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 19V5M19 12H5"/></svg>
                                    <!-- ADDED ID for real-time location/condition sync -->
                                    <span id="widget-location-display">æ™´æœ—, ä¸Šæµ·</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- END NEW WIDGET -->

                    <!-- B. App Grid Area (åº”ç”¨å›¾æ ‡åŒº) -->
                    <!-- Removed mt-12, added pt-8 for spacing after new widget -->
                    <div class="flex-grow p-4 pt-8 app-grid-area overflow-y-auto">
                        
                        <!-- å ä½ç¬¦åº”ç”¨å›¾æ ‡ç½‘æ ¼ -->
                        <div class="grid grid-cols-4 gap-y-6 pt-4">
                            
                            <!-- ROW 1 (Existing 1-4) -->
                            <!-- 1. æ¶ˆæ¯ -->
                            <button id="message-app-icon" class="flex flex-col items-center space-y-1 text-xs text-white app-icon-btn">
                                <div class="w-12 h-12 bg-red-500 rounded-xl shadow-lg flex items-center justify-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-white" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>
                                </div>
                                <span>æ¶ˆæ¯</span>
                            </button>
                            
                            <!-- 2. ç›¸å†Œ -->
                            <button id="gallery-app-icon" class="flex flex-col items-center space-y-1 text-xs text-white app-icon-btn">
                                <div class="w-12 h-12 bg-green-500 rounded-xl shadow-lg flex items-center justify-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-white" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg>
                                </div>
                                <span>ç›¸å†Œ</span>
                            </button>

                            <!-- 3. è®¾ç½® -->
                            <button id="settings-app-icon" class="flex flex-col items-center space-y-1 text-xs text-white app-icon-btn">
                                <div class="w-12 h-12 bg-gray-500 rounded-xl shadow-lg flex items-center justify-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-white" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83l-2.83 2.83a2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V23"></path><path d="M6 15a1.65 1.65 0 0 0-.33 1.82l-.06.06a2 2 0 0 1 0 2.83l2.83 2.83a2 2 0 0 1 2.83 0l.06-.06a1.65 1.65 0 0 0 1.82-.33 1.65 1.65 0 0 0 1 1.51V23"></path><path d="M19.4 9a1.65 1.65 0 0 0 .33-1.82l-.06-.06a2 2 0 0 1 0-2.83l-2.83-2.83a2 2 0 0 1-2.83 0l-.06.06a1.65 1.65 0 0 0-1.82.33 1.65 1.65 0 0 0-1-1.51V1"></path><path d="M6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83l2.83-2.83a2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33 1.65 1.65 0 0 0 1-1.51V1"></path></svg>
                                </div>
                                <span>è®¾ç½®</span>
                            </button>

                            <!-- 4. æµè§ˆå™¨ -->
                            <button id="browser-app-icon" class="flex flex-col items-center space-y-1 text-xs text-white app-icon-btn">
                                <div class="w-12 h-12 bg-yellow-500 rounded-xl shadow-lg flex items-center justify-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-white" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="2" y1="12" x2="22" y2="12"></line><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path></svg>
                                </div>
                                <span>æµè§ˆå™¨</span>
                            </button>
                            
                            <!-- ROW 2 (Existing 5-6 + New X, XHS) -->
                            <!-- 5. éŸ³ä¹ -->
                            <button id="music-app-icon" class="flex flex-col items-center space-y-1 text-xs text-white app-icon-btn">
                                <div class="w-12 h-12 bg-pink-500 rounded-xl shadow-lg flex items-center justify-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-white" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 18V5l12-2v13"></path><circle cx="6" cy="18" r="3"></circle><circle cx="18" cy="16" r="3"></circle></svg>
                                </div>
                                <span>éŸ³ä¹</span>
                            </button>

                            <!-- 6. AI åŠ©æ‰‹ (ç‚¹å‡»å¯åŠ¨ Modal) -->
                            <button id="ai-app-icon" class="flex flex-col items-center space-y-1 text-xs text-white app-icon-btn">
                                <div class="w-12 h-12 bg-indigo-500 rounded-xl shadow-lg flex items-center justify-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-white" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2v2M12 20v2M20 12h2M2 12h2M15 3.5l-1.5 1.5M10.5 19l1.5 1.5M18.5 15l-1.5 1.5M5.5 8l1.5 1.5"/></svg>
                                </div>
                                <span>AI å®£è¨€</span>
                            </button>
                            
                            <!-- 7. X (Twitter) -->
                            <button id="x-app-icon" class="flex flex-col items-center space-y-1 text-xs text-white app-icon-btn">
                                <div class="w-12 h-12 bg-black rounded-xl shadow-lg flex items-center justify-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-white" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M18.9 4.3l.9-1.3c-.6-.2-1.2-.3-1.8-.3C15.3 2.7 13.5 4.9 13.5 7.5v1.2H12c-.5 0-1 .4-1 .9v1.2c0 .5.5.9 1 .9h1.5v3.4c0 .8.6 1.5 1.5 1.5h1.2c.8 0 1.5-.6 1.5-1.5v-3.4H20c.5 0 .9-.5.9-1.2v-1.2c0-.5-.4-.9-.9-.9h-2.3V7.5c0-.9.7-1.7 1.6-1.7z"/></svg>
                                </div>
                                <span>X (æ¨ç‰¹)</span>
                            </button>

                            <!-- 8. å°çº¢ä¹¦ -->
                            <button id="xhs-app-icon" class="flex flex-col items-center space-y-1 text-xs text-white app-icon-btn">
                                <div class="w-12 h-12 bg-red-400 rounded-xl shadow-lg flex items-center justify-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-white" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 19.5V15A4.5 4.5 0 0 1 8.5 10.5H15A4.5 4.5 0 0 1 19.5 15V19.5a.5.5 0 0 1-.5.5H5a.5.5 0 0 1-.5-.5z"/><path d="M8 10h8m-8 4h8M4 5h16M12 5v15"/></svg>
                                </div>
                                <span>å°çº¢ä¹¦</span>
                            </button>

                            <!-- ROW 3 (New INS, Taobao, Tieba, Map) -->
                            <!-- 9. ins (Instagram) -->
                            <button id="ins-app-icon" class="flex flex-col items-center space-y-1 text-xs text-white app-icon-btn">
                                <div class="w-12 h-12 bg-gradient-to-tr from-yellow-400 via-pink-500 to-purple-600 rounded-xl shadow-lg flex items-center justify-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-white" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect><path d="M16 11.37A4 4 0 1 1 11.37 16 4 4 0 0 1 16 11.37z"></path><line x1="17.5" y1="6.5" x2="17.5" y2="6.5"></line></svg>
                                </div>
                                <span>ins</span>
                            </button>

                            <!-- 10. æ·˜å® -->
                            <button id="taobao-app-icon" class="flex flex-col items-center space-y-1 text-xs text-white app-icon-btn">
                                <div class="w-12 h-12 bg-orange-500 rounded-xl shadow-lg flex items-center justify-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-white" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"/><path d="M3 6h18"/><path d="M16 10a4 4 0 0 1-4 4h0a4 4 0 0 1-4-4"/></svg>
                                </div>
                                <span>æ·˜å®</span>
                            </button>

                            <!-- 11. è´´å§ -->
                            <button id="tieba-app-icon" class="flex flex-col items-center space-y-1 text-xs text-white app-icon-btn">
                                <div class="w-12 h-12 bg-blue-600 rounded-xl shadow-lg flex items-center justify-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-white" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
                                </div>
                                <span>è´´å§</span>
                            </button>
                            
                            <!-- 12. åœ°å›¾ -->
                            <button id="map-app-icon" class="flex flex-col items-center space-y-1 text-xs text-white app-icon-btn">
                                <div class="w-12 h-12 bg-green-600 rounded-xl shadow-lg flex items-center justify-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-white" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="1 6 1 22 8 18 16 22 23 18 23 2 16 6 8 2 1 6"></polygon><line x1="16" y1="2" x2="16" y2="22"></line><line x1="8" y1="2" x2="8" y2="18"></line></svg>
                                </div>
                                <span>åœ°å›¾</span>
                            </button>

                            <!-- ROW 4 (New Live, Weibo, Memo, Theme) -->
                             <!-- 13. ç›´æ’­ -->
                            <button id="live-app-icon" class="flex flex-col items-center space-y-1 text-xs text-white app-icon-btn">
                                <div class="w-12 h-12 bg-red-700 rounded-xl shadow-lg flex items-center justify-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-white" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 16v1a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h14l4 4-4 4z"></path></svg>
                                </div>
                                <span>ç›´æ’­</span>
                            </button>
                            
                            <!-- 14. å¾®åš -->
                            <button id="weibo-app-icon" class="flex flex-col items-center space-y-1 text-xs text-white app-icon-btn">
                                <div class="w-12 h-12 bg-yellow-600 rounded-xl shadow-lg flex items-center justify-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-white" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 20H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2h12v4M18 4h-2M15 4a3 3 0 0 0 0 6H4M22 17V8a2 2 0 0 0-2-2h-3M18 10l-4 4"/></svg>
                                </div>
                                <span>å¾®åš</span>
                            </button>

                             <!-- 15. å¤‡å¿˜å½• -->
                            <button id="memo-app-icon" class="flex flex-col items-center space-y-1 text-xs text-white app-icon-btn">
                                <div class="w-12 h-12 bg-lime-500 rounded-xl shadow-lg flex items-center justify-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-white" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><line x1="10" y1="9" x2="8" y2="9"/></svg>
                                </div>
                                <span>å¤‡å¿˜å½•</span>
                            </button>

                            <!-- 16. ä¸»é¢˜ -->
                            <button id="theme-app-icon" class="flex flex-col items-center space-y-1 text-xs text-white app-icon-btn">
                                <div class="w-12 h-12 bg-purple-500 rounded-xl shadow-lg flex items-center justify-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-white" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/><circle cx="12" cy="12" r="3"/><path d="M16 8l-2 2M8 8l2 2"/></svg>
                                </div>
                                <span>ä¸»é¢˜</span>
                            </button>
                        </div>
                    </div>
                    
                    <!-- C. Dock/Navigation Bar (åº•éƒ¨å¯¼èˆªæ ) -->
                    <div class="flex-shrink-0 h-16 bg-white/30 backdrop-blur-md rounded-3xl p-3 mx-4 flex justify-around items-center shadow-2xl">
                        <!-- ç”µè¯ -->
                        <button class="dock-icon-btn p-1">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-7 h-7 text-white" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 16.92v3a2 2 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-5.65-5.65 19.79 19.79 0 0 1-3.07-8.63A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path></svg>
                        </button>
                        <!-- å¾®ä¿¡/èŠå¤© -->
                        <button class="dock-icon-btn p-1">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-7 h-7 text-white" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>
                        </button>
                        <!-- æ‹ç…§ -->
                        <button class="dock-icon-btn p-1">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-7 h-7 text-white" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path><circle cx="12" cy="13" r="4"></circle></svg>
                        </button>
                        <!-- æµè§ˆå™¨ -->
                        <button class="dock-icon-btn p-1">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-7 h-7 text-white" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="2" y1="12" x2="22" y2="22"></line><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path></svg>
                        </button>
                    </div>

                    <!-- D. Home Indicator (Home æ ) -->
                    <!-- OPTIMIZED: Changed to fixed/absolute positioning within inner-screen for stability -->
                    <div id="home-indicator-container" class="absolute bottom-0 left-0 right-0 h-4 flex-shrink-0 flex items-center justify-center pb-2 z-60">
                        <div class="h-1 w-32 rounded-full bg-white/70"></div>
                    </div>
                </div>
                
                <!-- é”å±å¼€å±å±‚ - å§‹ç»ˆå¡«å……æ•´ä¸ªå±å¹• -->
                <div id="lock-screen" class="absolute inset-0 z-50 bg-gray-900/95 backdrop-blur-sm flex flex-col items-center justify-center transition-all duration-500 ease-in-out cursor-grab">
                    <div class="text-center">
                        <!-- é”å›¾æ ‡ -->
                        <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-16 h-16 text-indigo-400 mx-auto mb-10">
                            <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                            <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                        </svg>

                        <p class="text-2xl font-light text-white mb-10 tracking-wider">
                            æ»‘åŠ¨è§£é”
                        </p>

                        <!-- MODIFIED: Horizontal Unlock Slider -->
                        <div class="unlock-area mx-auto" id="unlockArea">
                            <div class="unlock-handle" id="unlockHandle">
                                <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-white" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 10 14 15 9 20"/></svg>
                            </div>
                        </div>
                        <!-- END MODIFIED -->
                    </div>
                </div>
                
                <!-- Notification/Control Center Panel (Z-index 40, below lock/modal) -->
                <div id="notification-center" class="absolute inset-0 z-40 bg-gray-900/95 backdrop-blur-md flex flex-col pt-8 px-4" style="transform: translateY(-100%);">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-3xl font-bold text-white">é€šçŸ¥ä¸­å¿ƒ</h2>
                        
                        <!-- REMOVED CLEAR ALL BUTTON FROM HEADER -->
                        <span id="notification-date" class="text-sm text-gray-400"></span>
                    </div>

                    <!-- Quick Toggles Grid -->
                    <div class="grid grid-cols-4 gap-4 mb-8">
                        <!-- Wi-Fi Toggle -->
                        <div class="flex flex-col items-center space-y-1">
                            <!-- Wi-Fi é»˜è®¤å¼€å¯çŠ¶æ€ -->
                            <button class="w-12 h-12 bg-indigo-500 rounded-full flex items-center justify-center toggle-btn">
                                <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-white" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12.55C6.39 10.97 8.5 10 12 10s5.61.97 7 2.55M12 20V10M17 15l-5 5-5-5"/></svg>
                            </button>
                            <!-- UPDATED: Added w-full text-center -->
                            <span class="text-xs text-white w-full text-center">Wi-Fi</span>
                        </div>
                        
                        <!-- Bluetooth Toggle (æ–°å¢ ID ç”¨äºäº¤äº’) -->
                        <div class="flex flex-col items-center space-y-1">
                            <button id="bluetooth-toggle" 
                                    class="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center toggle-btn">
                                <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-white" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M7 11L17 5L12 12L17 19L7 13L12 12"/></svg>
                            </button>
                            <!-- UPDATED: Added w-full text-center -->
                            <span id="bluetooth-status-text" class="text-xs text-gray-300 w-full text-center">è“ç‰™</span>
                        </div>
                        
                        <!-- Rotation Lock -->
                        <div class="flex flex-col items-center space-y-1">
                            <button class="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center toggle-btn">
                                <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-white" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2v2M22 12h-2M4 12H2M19 19L17 17M7 7L5 5M12 22a10 10 0 1 0 0-20 10 10 0 0 0 0 20z"/></svg>
                            </button>
                            <!-- UPDATED: Added w-full text-center -->
                            <span class="text-xs text-gray-300 w-full text-center">æ—‹è½¬</span>
                        </div>
                        <!-- Flashlight (æ–°å¢ ID ç”¨äºäº¤äº’) -->
                        <div class="flex flex-col items-center space-y-1">
                            <button id="flashlight-toggle" class="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center toggle-btn">
                                <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-white" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 12V3H9V12L5 16H8L9 21H15L16 16H19L15 12Z"/></svg>
                            </button>
                            <!-- UPDATED: Added w-full text-center -->
                            <span id="flashlight-status-text" class="text-xs text-gray-300 w-full text-center">æ‰‹ç”µç­’</span>
                        </div>
                    </div>

                    <!-- Brightness Slider (Placeholder) -->
                    <!-- ADDED ID for JS swipe exclusion -->
                    <div id="brightness-container" class="mb-8 p-3 bg-white/10 rounded-xl">
                        <label class="text-white text-sm block mb-1">äº®åº¦è°ƒèŠ‚</label>
                        <div class="flex items-center space-x-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-gray-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>
                            <!-- ADDED ID for slider input -->
                            <input id="brightness-slider" type="range" class="w-full h-1 bg-gray-600 rounded-lg appearance-none cursor-pointer range-lg" min="0" max="100" value="70">
                        </div>
                    </div>

                    <!-- Notifications Placeholder -->
                    <div id="notification-list-container" class="flex-grow overflow-y-auto">
                        
                        <div id="active-notifications" class="space-y-3">
                            <div class="bg-gray-700/50 p-3 rounded-xl" id="notif-1">
                                <p class="text-sm font-semibold text-white">å¾®ä¿¡</p>
                                <p class="text-xs text-gray-300">æ–°æ¶ˆæ¯: æ”¶åˆ° 1 æ¡æœªè¯»ä¿¡æ¯ã€‚</p>
                            </div>
                            <div class="bg-gray-700/50 p-3 rounded-xl" id="notif-2">
                                <p class="text-sm font-semibold text-white">ç³»ç»Ÿ</p>
                                <p class="text-xs text-gray-300">ç³»ç»Ÿæ›´æ–°å¯åœ¨è®¾ç½®ä¸­è¿›è¡Œã€‚</p>
                            </div>
                            <!-- Filler notifications to make it look scrollable -->
                            <div class="bg-gray-700/50 p-3 rounded-xl" id="notif-3">
                                <p class="text-sm font-semibold text-white">æµè§ˆå™¨</p>
                                <p class="text-xs text-gray-300">æœ€æ–° Gemini æ›´æ–°ï¼šç°å·²æ”¯æŒå›¾åƒç”Ÿæˆã€‚</p>
                            </div>
                            <div class="bg-gray-700/50 p-3 rounded-xl" id="notif-4">
                                <p class="text-sm font-semibold text-white">æ—¥å†</p>
                                <p class="text-xs text-gray-300">æé†’: ä¸‹åˆ 2 ç‚¹æœ‰çº¿ä¸Šä¼šè®®ã€‚</p>
                            </div>
                        </div>

                        <!-- NEW: Clear All Notifications Button at the bottom of the list container (Pill shape) -->
                        <div class="mt-4 mb-4 flex justify-center">
                            <button id="clear-all-notifications" 
                                    class="py-2 px-6 rounded-full text-white font-medium hover:bg-white/20 transition duration-150 toggle-btn bg-white/10" 
                                    title="æ¸…é™¤å…¨éƒ¨é€šçŸ¥">
                                <!-- Trash/Clear Icon -->
                                <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 inline-block mr-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"></path><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"></path><path d="M10 11v6"></path><path d="M14 11v6"></path><path d="M15 6V4a2 2 0 0 0-2-2h-2a2 2 0 0 0-2 2v2"></path></svg>
                                æ¸…é™¤å…¨éƒ¨
                            </button>
                        </div>
                        
                        <!-- Message when no notifications -->
                        <div class="text-center mt-6 hidden" id="no-notifications-message">
                            <p class="text-sm text-gray-400">æ— æ›´å¤šé€šçŸ¥</p>
                        </div>
                    </div>

                    <!-- Home Indicator in Notification Center -->
                    <div class="h-4 flex-shrink-0 flex items-center justify-center pb-2">
                        <div id="notif-home-indicator" class="h-1 w-32 rounded-full bg-gray-400/70 cursor-pointer"></div>
                    </div>
                </div>
                
                <!-- --- APP MODALS START HERE (Z-index 55-59) --- -->

                <!-- 1. AI åº”ç”¨æ¨¡æ€æ¡† (Full-Screen Modal) -->
                <div id="ai-app-modal" 
                     class="absolute inset-0 z-[55] bg-gray-50 flex flex-col app-modal">
                    
                    <!-- App Header -->
                    <div class="flex-shrink-0 p-4 bg-indigo-600 text-white shadow-md flex items-center justify-between">
                        <button class="close-app-btn text-lg font-medium hover:text-indigo-200 transition" data-app-id="ai-app-modal" data-app-name="AI å®£è¨€">
                            <!-- è¿”å›ç®­å¤´ -->
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 inline-block mr-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>
                            è¿”å›
                        </button>
                        <h2 class="text-xl font-bold">AI èŒä¸šå®£è¨€</h2>
                        <div class="w-16"></div> <!-- Spacer -->
                    </div>

                    <!-- App Content -->
                    <div class="flex-grow p-6 overflow-y-auto bg-gray-100">
                        <div class="bg-white p-6 rounded-xl shadow-lg">
                            <h3 class="text-2xl font-bold text-gray-800 mb-4 border-b pb-2">ç”Ÿæˆæ‚¨çš„ä½¿å‘½å®£è¨€</h3>
                            <p class="text-gray-600 mb-4">
                                åŸºäºé¢„è®¾çš„â€œå‰ç«¯å¼€å‘çˆ±å¥½è€… | æ•°å­—è‰ºæœ¯å®¶â€ç®€ä»‹ï¼Œç‚¹å‡»ä¸‹æ–¹æŒ‰é’®ï¼Œè®© Gemini ä¸ºæ‚¨ç”Ÿæˆä¸€å¥æœ‰åŠ›çš„èŒä¸šå£å·ã€‚
                            </p>
                            
                            <!-- AI Output Display -->
                            <div id="mission-statement-display-modal" class="mb-6 p-4 min-h-[60px] flex items-center justify-center bg-indigo-50 border-2 border-indigo-200 rounded-lg">
                                <p class="text-base text-gray-500 text-center">å®£è¨€å°†åœ¨æ­¤å¤„æ˜¾ç¤º...</p>
                            </div>
                            
                            <button id="generate-mission-btn-modal" 
                                    class="w-full py-3 bg-indigo-600 text-white font-semibold rounded-xl hover:bg-indigo-700 transition duration-300 shadow-md disabled:bg-indigo-400">
                                âœ¨ è¿è¡Œ AI ç”Ÿæˆ
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- 2. æ¶ˆæ¯åº”ç”¨æ¨¡æ€æ¡† -->
                <div id="message-app-modal" class="absolute inset-0 z-[55] bg-gray-50 flex flex-col app-modal">
                    <div class="flex-shrink-0 p-4 bg-red-600 text-white shadow-md flex items-center justify-between">
                        <button class="close-app-btn text-lg font-medium hover:text-red-200 transition" data-app-id="message-app-modal" data-app-name="æ¶ˆæ¯">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 inline-block mr-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>
                            è¿”å›
                        </button>
                        <h2 class="text-xl font-bold">æ¶ˆæ¯</h2>
                        <div class="w-16"></div>
                    </div>
                    <div class="flex-grow p-6 overflow-y-auto bg-gray-100">
                        <p class="text-center text-gray-500 mt-10">è¿™æ˜¯æ‚¨çš„èŠå¤©è®°å½•ç•Œé¢ã€‚è¯·ç­‰å¾…æ–°æ¶ˆæ¯...</p>
                        <div class="space-y-3 mt-6">
                            <div class="bg-white p-3 rounded-lg shadow">
                                <p class="font-semibold text-gray-800">ç³»ç»Ÿé€šçŸ¥</p>
                                <p class="text-sm text-gray-500">æ¬¢è¿ä½¿ç”¨æ¨¡æ‹Ÿæ¶ˆæ¯åº”ç”¨ï¼</p>
                            </div>
                            <div class="bg-white p-3 rounded-lg shadow">
                                <p class="font-semibold text-gray-800">è”ç³»äºº A</p>
                                <p class="text-sm text-gray-500">ï¼ˆå ä½ç¬¦ï¼šæœ€æ–°å›å¤ï¼‰</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 3. ç›¸å†Œåº”ç”¨æ¨¡æ€æ¡† -->
                <div id="gallery-app-modal" class="absolute inset-0 z-[55] bg-gray-50 flex flex-col app-modal">
                    <div class="flex-shrink-0 p-4 bg-green-600 text-white shadow-md flex items-center justify-between">
                        <button class="close-app-btn text-lg font-medium hover:text-green-200 transition" data-app-id="gallery-app-modal" data-app-name="ç›¸å†Œ">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 inline-block mr-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>
                            è¿”å›
                        </button>
                        <h2 class="text-xl font-bold">ç›¸å†Œ</h2>
                        <div class="w-16"></div>
                    </div>
                    <div class="flex-grow p-4 overflow-y-auto bg-gray-100">
                        <div class="grid grid-cols-3 gap-1">
                            <!-- Placeholder Images -->
                            <img src="https://placehold.co/120x120/4f46e5/ffffff/png?text=Pic+1" alt="Placeholder Image 1" class="w-full h-auto rounded-lg object-cover">
                            <img src="https://placehold.co/120x120/10b981/ffffff/png?text=Pic+2" alt="Placeholder Image 2" class="w-full h-auto rounded-lg object-cover">
                            <img src="https://placehold.co/120x120/f97316/ffffff/png?text=Pic+3" alt="Placeholder Image 3" class="w-full h-auto rounded-lg object-cover">
                            <img src="https://placehold.co/120x120/ef4444/ffffff/png?text=Pic+4" alt="Placeholder Image 4" class="w-full h-auto rounded-lg object-cover">
                            <img src="https://placehold.co/120x120/e879f9/ffffff/png?text=Pic+5" alt="Placeholder Image 5" class="w-full h-auto rounded-lg object-cover">
                            <img src="https://placehold.co/120x120/60a5fa/ffffff/png?text=Pic+6" alt="Placeholder Image 6" class="w-full h-auto rounded-lg object-cover">
                        </div>
                        <p class="text-center text-gray-500 mt-4 text-sm">æ‚¨çš„ç²¾å½©ç¬é—´</p>
                    </div>
                </div>

                <!-- 4. è®¾ç½®åº”ç”¨æ¨¡æ€æ¡† -->
                <div id="settings-app-modal" class="absolute inset-0 z-[55] bg-gray-50 flex flex-col app-modal">
                    <div class="flex-shrink-0 p-4 bg-gray-700 text-white shadow-md flex items-center justify-between">
                        <button class="close-app-btn text-lg font-medium hover:text-gray-400 transition" data-app-id="settings-app-modal" data-app-name="è®¾ç½®">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 inline-block mr-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>
                            è¿”å›
                        </button>
                        <h2 class="text-xl font-bold">è®¾ç½®</h2>
                        <div class="w-16"></div>
                    </div>
                    <div class="flex-grow p-6 overflow-y-auto bg-white">
                        <ul class="space-y-4">
                            <li class="p-3 bg-gray-100 rounded-lg flex justify-between items-center shadow-sm">
                                <span class="font-medium text-gray-800">Wi-Fi & ç½‘ç»œ</span>
                                <span class="text-sm text-indigo-600">å·²è¿æ¥</span>
                            </li>
                            <li class="p-3 bg-gray-100 rounded-lg flex justify-between items-center shadow-sm">
                                <span class="font-medium text-gray-800">æ˜¾ç¤ºä¸äº®åº¦</span>
                                <span class="text-sm text-gray-500">70%</span>
                            </li>
                            <li class="p-3 bg-gray-100 rounded-lg flex justify-between items-center shadow-sm">
                                <span class="font-medium text-gray-800">ç³»ç»Ÿæ›´æ–°</span>
                                <span class="text-sm text-red-500 font-bold">æœ‰å¯ç”¨æ›´æ–°</span>
                            </li>
                        </ul>
                    </div>
                </div>

                <!-- 5. æµè§ˆå™¨åº”ç”¨æ¨¡æ€æ¡† -->
                <div id="browser-app-modal" class="absolute inset-0 z-[55] bg-gray-50 flex flex-col app-modal">
                    <div class="flex-shrink-0 p-4 bg-yellow-600 text-white shadow-md flex items-center justify-between">
                        <button class="close-app-btn text-lg font-medium hover:text-yellow-200 transition" data-app-id="browser-app-modal" data-app-name="æµè§ˆå™¨">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 inline-block mr-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>
                            è¿”å›
                        </button>
                        <h2 class="text-xl font-bold">æµè§ˆå™¨</h2>
                        <div class="w-16"></div>
                    </div>
                    <div class="flex-grow p-6 overflow-y-auto bg-gray-100">
                        <div class="bg-white p-4 rounded-xl shadow-lg">
                            <h3 class="text-lg font-bold text-gray-800 mb-2">æ¬¢è¿ä½¿ç”¨æ¨¡æ‹Ÿæµè§ˆå™¨</h3>
                            <p class="text-sm text-gray-600">è¿™æ˜¯æ‚¨çš„èµ·å§‹é¡µã€‚æœç´¢æˆ–è¾“å…¥ç½‘å€å¼€å§‹æµè§ˆã€‚</p>
                            <div class="mt-4 flex space-x-2">
                                <button class="flex-1 py-2 bg-indigo-500 text-white rounded-lg text-sm">æœç´¢</button>
                                <button class="flex-1 py-2 bg-gray-200 text-gray-700 rounded-lg text-sm">å†å²è®°å½•</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 6. éŸ³ä¹åº”ç”¨æ¨¡æ€æ¡† -->
                <div id="music-app-modal" class="absolute inset-0 z-[55] bg-gray-50 flex flex-col app-modal">
                    <div class="flex-shrink-0 p-4 bg-pink-600 text-white shadow-md flex items-center justify-between">
                        <button class="close-app-btn text-lg font-medium hover:text-pink-200 transition" data-app-id="music-app-modal" data-app-name="éŸ³ä¹">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 inline-block mr-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>
                            è¿”å›
                        </button>
                        <h2 class="text-xl font-bold">éŸ³ä¹</h2>
                        <div class="w-16"></div>
                    </div>
                    <div class="flex-grow p-6 overflow-y-auto bg-gray-100">
                        <div class="bg-white p-6 rounded-xl shadow-lg text-center">
                            <img src="https://placehold.co/150x150/d1d5db/ffffff/png?text=Album+Art" alt="Album Art" class="mx-auto rounded-xl shadow-md mb-4">
                            <p class="text-2xl font-bold text-gray-800">æ¨¡æ‹Ÿæ­Œæ›²åç§°</p>
                            <p class="text-lg text-gray-600">æ¨¡æ‹Ÿè‰ºæœ¯å®¶</p>
                            <div class="mt-6 flex justify-center items-center space-x-6">
                                <button class="text-gray-700 hover:text-pink-600 transition"><svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="19 20 9 12 19 4 19 20"></polygon><line x1="5" y1="19" x2="5" y2="5"></line></svg></button>
                                <button class="text-pink-600 hover:text-pink-800 transition"><svg xmlns="http://www.w3.org/2000/svg" class="w-12 h-12" viewBox="0 0 24 24" fill="currentColor"><circle cx="12" cy="12" r="10"></circle><path d="M10 8l6 4-6 4V8z" fill="white"></path></svg></button>
                                <button class="text-gray-700 hover:text-pink-600 transition"><svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="5 4 15 12 5 20 5 4"></polygon><line x1="19" y1="5" x2="19" y2="19"></line></svg></button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 7. X (Twitter) åº”ç”¨æ¨¡æ€æ¡† -->
                <div id="x-app-modal" class="absolute inset-0 z-[55] bg-gray-50 flex flex-col app-modal">
                    <div class="flex-shrink-0 p-4 bg-black text-white shadow-md flex items-center justify-between">
                        <button class="close-app-btn text-lg font-medium hover:text-gray-300 transition" data-app-id="x-app-modal" data-app-name="X (æ¨ç‰¹)">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 inline-block mr-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>
                            è¿”å›
                        </button>
                        <h2 class="text-xl font-bold">X (æ¨ç‰¹)</h2>
                        <div class="w-16"></div>
                    </div>
                    <div class="flex-grow p-6 overflow-y-auto bg-gray-100">
                        <p class="text-center text-gray-500 mt-10">æ¬¢è¿æ¥åˆ° Xï¼è¿™æ˜¯ä¸€ä¸ªå®æ—¶ä¿¡æ¯æµçš„å ä½ç¬¦ã€‚</p>
                        <div class="mt-6 space-y-4">
                            <div class="bg-white p-4 rounded-xl shadow">
                                <p class="font-semibold text-gray-800">@GeminiDev</p>
                                <p class="text-sm text-gray-600">æ¨¡æ‹Ÿå‘å¸ƒï¼šAI æ‰‹æœºç•Œé¢äº¤äº’å·²å®Œæˆ 90%ï¼ä¸æ»‘ä½“éªŒå³å°†ä¸Šçº¿ã€‚#UIUX</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 8. å°çº¢ä¹¦åº”ç”¨æ¨¡æ€æ¡† -->
                <div id="xhs-app-modal" class="absolute inset-0 z-[55] bg-gray-50 flex flex-col app-modal">
                    <div class="flex-shrink-0 p-4 bg-red-400 text-white shadow-md flex items-center justify-between">
                        <button class="close-app-btn text-lg font-medium hover:text-red-200 transition" data-app-id="xhs-app-modal" data-app-name="å°çº¢ä¹¦">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 inline-block mr-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>
                            è¿”å›
                        </button>
                        <h2 class="text-xl font-bold">å°çº¢ä¹¦</h2>
                        <div class="w-16"></div>
                    </div>
                    <div class="flex-grow p-6 overflow-y-auto bg-gray-100">
                        <p class="text-center text-gray-500 mt-10">æ¢ç´¢ç¾å¥½ç”Ÿæ´»ï¼è¿™æ˜¯ä¸€ä¸ªåŒåˆ—ç€‘å¸ƒæµçš„å ä½ç¬¦ã€‚</p>
                        <div class="grid grid-cols-2 gap-3 mt-4">
                            <div class="bg-white rounded-xl shadow overflow-hidden">
                                <img src="https://placehold.co/150x200/f87171/ffffff/png?text=Fashion" alt="Fashion Post" class="w-full h-auto">
                                <p class="p-2 text-xs text-gray-600">ä»Šæ—¥ç©¿æ­åˆ†äº«ï¼</p>
                            </div>
                            <div class="bg-white rounded-xl shadow overflow-hidden">
                                <img src="https://placehold.co/150x250/22c55e/ffffff/png?text=Travel" alt="Travel Post" class="w-full h-auto">
                                <p class="p-2 text-xs text-gray-600">å‘¨æœ«æˆ·å¤–æ¢åº—æ”»ç•¥ï¼</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 9. ins (Instagram) åº”ç”¨æ¨¡æ€æ¡† -->
                <div id="ins-app-modal" class="absolute inset-0 z-[55] bg-gray-50 flex flex-col app-modal">
                    <div class="flex-shrink-0 p-4 bg-pink-600 text-white shadow-md flex items-center justify-between">
                        <button class="close-app-btn text-lg font-medium hover:text-pink-200 transition" data-app-id="ins-app-modal" data-app-name="Instagram">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 inline-block mr-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>
                            è¿”å›
                        </button>
                        <h2 class="text-xl font-bold">Instagram</h2>
                        <div class="w-16"></div>
                    </div>
                    <div class="flex-grow p-6 overflow-y-auto bg-gray-100">
                        <p class="text-center text-gray-500 mt-10">åˆ†äº«ä½ çš„ç²¾å½©ç¬é—´ï¼è¿™æ˜¯å›¾ç‰‡ Feed å ä½ç¬¦ã€‚</p>
                        <div class="mt-6 space-y-4">
                            <div class="bg-white rounded-xl shadow">
                                <img src="https://placehold.co/400x300/f59e0b/ffffff/png?text=Story" alt="Image Post" class="w-full h-auto rounded-t-xl">
                                <div class="p-3">
                                    <p class="font-semibold">@User_A</p>
                                    <p class="text-sm text-gray-600">æ–°ç…§ç‰‡å‘å¸ƒï¼šé˜³å…‰ä¸‹çš„å’–å•¡ â˜•</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 10. æ·˜å®åº”ç”¨æ¨¡æ€æ¡† -->
                <div id="taobao-app-modal" class="absolute inset-0 z-[55] bg-gray-50 flex flex-col app-modal">
                    <div class="flex-shrink-0 p-4 bg-orange-500 text-white shadow-md flex items-center justify-between">
                        <button class="close-app-btn text-lg font-medium hover:text-orange-200 transition" data-app-id="taobao-app-modal" data-app-name="æ·˜å®">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 inline-block mr-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>
                            è¿”å›
                        </button>
                        <h2 class="text-xl font-bold">æ·˜å®</h2>
                        <div class="w-16"></div>
                    </div>
                    <div class="flex-grow p-6 overflow-y-auto bg-gray-100">
                        <p class="text-center text-gray-500 mt-10">ä¸‡èƒ½çš„æ·˜å®ï¼è¿™æ˜¯å•†å“åˆ—è¡¨å ä½ç¬¦ã€‚</p>
                        <div class="mt-6 space-y-4">
                            <div class="bg-white p-3 rounded-xl shadow flex items-center">
                                <img src="https://placehold.co/60x60/f97316/ffffff/png?text=Item" alt="Product" class="rounded-lg mr-4">
                                <div>
                                    <p class="font-semibold text-gray-800">å•†å“åç§°ï¼šæ™ºèƒ½æ‰‹æœºå£³</p>
                                    <p class="text-red-500 font-bold">Â¥ 49.90</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 11. è´´å§åº”ç”¨æ¨¡æ€æ¡† -->
                <div id="tieba-app-modal" class="absolute inset-0 z-[55] bg-gray-50 flex flex-col app-modal">
                    <div class="flex-shrink-0 p-4 bg-blue-600 text-white shadow-md flex items-center justify-between">
                        <button class="close-app-btn text-lg font-medium hover:text-blue-200 transition" data-app-id="tieba-app-modal" data-app-name="è´´å§">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 inline-block mr-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>
                            è¿”å›
                        </button>
                        <h2 class="text-xl font-bold">è´´å§</h2>
                        <div class="w-16"></div>
                    </div>
                    <div class="flex-grow p-6 overflow-y-auto bg-gray-100">
                        <p class="text-center text-gray-500 mt-10">å…´è¶£äº¤å‹ç¤¾åŒºï¼è¿™æ˜¯çƒ­é—¨å¸–å­å ä½ç¬¦ã€‚</p>
                        <div class="mt-6 space-y-4">
                            <div class="bg-white p-4 rounded-xl shadow">
                                <p class="font-semibold text-gray-800">#æ‰‹æœºæ¨¡æ‹Ÿå§</p>
                                <p class="text-sm text-gray-600">ä¸»é¢˜ï¼šæœ‰æ²¡æœ‰äººè§‰å¾—æ–°ç‰ˆçš„äº¤äº’æ›´ä¸æ»‘äº†ï¼Ÿ</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 12. åœ°å›¾åº”ç”¨æ¨¡æ€æ¡† -->
                <div id="map-app-modal" class="absolute inset-0 z-[55] bg-gray-50 flex flex-col app-modal">
                    <div class="flex-shrink-0 p-4 bg-green-600 text-white shadow-md flex items-center justify-between">
                        <button class="close-app-btn text-lg font-medium hover:text-green-200 transition" data-app-id="map-app-modal" data-app-name="åœ°å›¾">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 inline-block mr-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>
                            è¿”å›
                        </button>
                        <h2 class="text-xl font-bold">åœ°å›¾</h2>
                        <div class="w-16"></div>
                    </div>
                    <div class="flex-grow p-0 overflow-hidden bg-gray-100 relative">
                        <div class="absolute inset-0 flex items-center justify-center bg-green-200">
                            <p class="text-xl text-green-700 font-bold">åœ°å›¾åŠ è½½ä¸­...</p>
                        </div>
                        <div class="p-4 absolute bottom-0 w-full bg-white/90 backdrop-blur-sm shadow-lg">
                             <p class="text-sm text-gray-700">å½“å‰ä½ç½®ï¼šåŒ—äº¬ï¼Œè·ç¦»ç›®çš„åœ° $1.5$ km</p>
                        </div>
                    </div>
                </div>

                <!-- 13. ç›´æ’­åº”ç”¨æ¨¡æ€æ¡† -->
                <div id="live-app-modal" class="absolute inset-0 z-[55] bg-gray-50 flex flex-col app-modal">
                    <div class="flex-shrink-0 p-4 bg-red-700 text-white shadow-md flex items-center justify-between">
                        <button class="close-app-btn text-lg font-medium hover:text-red-300 transition" data-app-id="live-app-modal" data-app-name="ç›´æ’­">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 inline-block mr-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>
                            è¿”å›
                        </button>
                        <h2 class="text-xl font-bold">ç›´æ’­</h2>
                        <div class="w-16"></div>
                    </div>
                    <div class="flex-grow p-0 overflow-hidden bg-black relative">
                        <div class="absolute inset-0 flex items-center justify-center">
                            <span class="text-red-500 text-2xl animate-pulse">ğŸ”´ LIVE...</span>
                        </div>
                        <div class="p-3 absolute bottom-0 w-full bg-black/50 text-white">
                             <p class="text-sm">ä¸»æ’­ï¼šAI ç•Œé¢è®¾è®¡å¸ˆ</p>
                             <p class="text-xs text-gray-300">è§‚ä¼—ï¼š999+</p>
                        </div>
                    </div>
                </div>
                
                <!-- 14. å¾®åšåº”ç”¨æ¨¡æ€æ¡† -->
                <div id="weibo-app-modal" class="absolute inset-0 z-[55] bg-gray-50 flex flex-col app-modal">
                    <div class="flex-shrink-0 p-4 bg-yellow-600 text-white shadow-md flex items-center justify-between">
                        <button class="close-app-btn text-lg font-medium hover:text-yellow-200 transition" data-app-id="weibo-app-modal" data-app-name="å¾®åš">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 inline-block mr-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>
                            è¿”å›
                        </button>
                        <h2 class="text-xl font-bold">å¾®åš</h2>
                        <div class="w-16"></div>
                    </div>
                    <div class="flex-grow p-6 overflow-y-auto bg-gray-100">
                        <p class="text-center text-gray-500 mt-10">éšæ—¶éšåœ°å‘ç°æ–°é²œäº‹ï¼è¿™æ˜¯çƒ­é—¨è¯é¢˜å ä½ç¬¦ã€‚</p>
                        <div class="mt-6 space-y-4">
                            <div class="bg-white p-4 rounded-xl shadow">
                                <p class="font-semibold text-gray-800">#AIäº¤äº’æ–°è¶‹åŠ¿</p>
                                <p class="text-sm text-gray-600">è®¨è®ºï¼šæœªæ¥æ‰‹æœºç•Œé¢åº”å¦‚ä½•è¿›åŒ–ï¼Ÿ</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 15. å¤‡å¿˜å½•åº”ç”¨æ¨¡æ€æ¡† -->
                <div id="memo-app-modal" class="absolute inset-0 z-[55] bg-gray-50 flex flex-col app-modal">
                    <div class="flex-shrink-0 p-4 bg-lime-500 text-white shadow-md flex items-center justify-between">
                        <button class="close-app-btn text-lg font-medium hover:text-lime-200 transition" data-app-id="memo-app-modal" data-app-name="å¤‡å¿˜å½•">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 inline-block mr-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>
                            è¿”å›
                        </button>
                        <h2 class="text-xl font-bold">å¤‡å¿˜å½•</h2>
                        <div class="w-16"></div>
                    </div>
                    <div class="flex-grow p-6 overflow-y-auto bg-white">
                        <ul class="space-y-3">
                            <li class="p-3 bg-lime-50 rounded-lg border-l-4 border-lime-600 shadow-sm">
                                <p class="font-medium text-gray-800">ğŸ›’ è´­ä¹°æ¸…å•ï¼šç‰›å¥¶ã€é¸¡è›‹ã€é¢åŒ…ã€‚</p>
                            </li>
                            <li class="p-3 bg-lime-50 rounded-lg border-l-4 border-lime-600 shadow-sm">
                                <p class="font-medium text-gray-800">ğŸ’¡ äº¤äº’çµæ„Ÿï¼šå°è¯•å¤šç‚¹è§¦æ§æ‰‹åŠ¿ã€‚</p>
                            </li>
                        </ul>
                    </div>
                </div>

                <!-- 16. ä¸»é¢˜åº”ç”¨æ¨¡æ€æ¡† -->
                <div id="theme-app-modal" class="absolute inset-0 z-[55] bg-gray-50 flex flex-col app-modal">
                    <div class="flex-shrink-0 p-4 bg-purple-500 text-white shadow-md flex items-center justify-between">
                        <button class="close-app-btn text-lg font-medium hover:text-purple-200 transition" data-app-id="theme-app-modal" data-app-name="ä¸»é¢˜">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 inline-block mr-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>
                            è¿”å›
                        </button>
                        <h2 class="text-xl font-bold">ä¸»é¢˜</h2>
                        <div class="w-16"></div>
                    </div>
                    <div class="flex-grow p-6 overflow-y-auto bg-gray-100">
                        <p class="text-center text-gray-500 mt-10">ä¸ªæ€§åŒ–ä½ çš„æ‰‹æœºï¼è¿™æ˜¯ä¸»é¢˜é€‰æ‹©å ä½ç¬¦ã€‚</p>
                        <div class="mt-6 space-y-4">
                            <div class="p-4 bg-white rounded-xl shadow text-center">
                                <p class="font-bold text-gray-800">å½“å‰ä¸»é¢˜: æç®€æ·±è‰²</p>
                                <button class="mt-3 py-2 px-4 bg-purple-600 text-white rounded-lg text-sm hover:bg-purple-700 transition">åˆ‡æ¢ä¸»é¢˜</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- MODIFIED: Bluetooth Configuration Modal (Bottom Sheet) -->
                <div id="bluetooth-config-modal" 
                     class="absolute bottom-0 left-0 right-0 z-[56] bg-gray-50 flex flex-col 
                            rounded-t-3xl shadow-2xl overflow-hidden" 
                     style="height: 70%; max-height: 500px;">
                    
                    <!-- Grabber/Handle -->
                    <div class="flex-shrink-0 p-3 flex justify-center border-b border-gray-200 bg-white">
                        <div class="w-10 h-1 bg-gray-300 rounded-full"></div>
                    </div>

                    <!-- Content -->
                    <div class="flex-grow p-6 overflow-y-auto bg-white">
                        <h3 class="text-2xl font-bold text-gray-800 mb-4">è“ç‰™è®¾å¤‡</h3>
                        
                        <!-- Current Status: MODIFIED to use flex for left/right alignment -->
                        <div class="flex justify-between items-center mb-4 border-b pb-4 text-gray-600">
                            <!-- å·¦ä¾§æ ‡ç­¾ -->
                            <span class="text-base font-medium">çŠ¶æ€:</span>
                            <!-- å³ä¾§çŠ¶æ€å€¼ -->
                            <span id="bluetooth-modal-status" class="font-semibold text-red-500 text-base">å…³é—­</span>
                        </div>
                        
                        <!-- Search Button -->
                        <button id="start-bluetooth-scan"
                                class="w-full py-3 bg-indigo-600 text-white font-semibold rounded-xl hover:bg-indigo-700 transition duration-300 shadow-md disabled:bg-indigo-400 mb-6">
                            æœç´¢å¯è¿æ¥è®¾å¤‡
                        </button>

                        <!-- Device List -->
                        <h4 class="text-lg font-bold text-gray-800 mb-3">å¯ç”¨è®¾å¤‡</h4>
                        <ul id="available-devices-list" class="space-y-3">
                            <!-- Initial/Connected Device (Added class for exclusion from dynamic removal) -->
                            <li class="p-3 bg-indigo-50 rounded-lg flex justify-between items-center border border-indigo-200 initial-device">
                                <span class="font-medium text-indigo-800">My Gemini Headset</span>
                                <span class="text-sm text-indigo-600 font-bold" id="headset-status">æœªè¿æ¥</span>
                            </li>
                            <li class="p-3 bg-gray-50 rounded-lg flex justify-between items-center border initial-device">
                                <span class="font-medium text-gray-800">Desktop Speaker</span>
                                <button class="text-indigo-600 text-sm font-medium hover:text-indigo-800">è¿æ¥</button>
                            </li>
                        </ul>
                        
                        <p class="text-center text-sm text-gray-400 mt-6">
                            é•¿æŒ‰æˆ–æ‹–åŠ¨ Home Indicator å…³é—­ã€‚
                        </p>
                    </div>
                </div>
                
            </div>
            
        </div>
    </div>

    <!-- JavaScript é€»è¾‘ -->
    <script>
        const apiKey = ""; 
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;

        // --- GLOBAL STATE VARIABLES (Moved to top for scope safety) ---
        let isEditMode = false;
        const HOME_LONG_PRESS_DURATION = 500; 
        let homePressTimer = null;
        let startPressX = 0; 
        let startPressY = 0;

        let isBluetoothOn = false;
        let isBluetoothConnected = false;
        let connectedDeviceName = "My Gemini Headset"; 
        let isScanning = false; 

        let pressTimer = null;
        const LONG_PRESS_DURATION = 500; 
        let dragStartX = 0; 
        
        // Utility function for exponential backoff
        async function fetchWithRetry(url, options, maxRetries = 5) {
            for (let i = 0; i < maxRetries; i++) {
                try {
                    const response = await fetch(url, options);
                    if (response.status === 429 && i < maxRetries - 1) {
                        const delay = Math.pow(2, i) * 1000 + Math.random() * 1000;
                        console.warn(`Rate limit hit. Retrying in ${delay / 1000}s...`);
                        await new Promise(resolve => setTimeout(resolve, delay));
                        continue;
                    }
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response;
                } catch (error) {
                    if (i === maxRetries - 1) throw error;
                    console.error('Fetch attempt ${i + 1} failed:', error.message);
                }
            }
        }

        // --- æ¶ˆæ¯æç¤ºæ¡†é€»è¾‘ (æ›¿ä»£ alert) ---
        function showMessage(message, color = 'green') {
            let msgBox = document.getElementById('message-box');
            if (!msgBox) {
                msgBox = document.createElement('div');
                msgBox.id = 'message-box';
                // ç¡®ä¿ z-index é«˜äºæ‰€æœ‰ UI å…ƒç´ 
                msgBox.className = 'fixed top-4 left-1/2 -translate-x-1/2 text-white p-3 rounded-lg shadow-xl opacity-0 transition-opacity duration-300 z-[70] text-sm';
                document.body.appendChild(msgBox);
            }
            // Clear previous color and set new one
            msgBox.className = msgBox.className.replace(/bg-(green|red|indigo|yellow|lime|black|orange|blue|purple)-500/g, ''); 
            msgBox.classList.add(`bg-${color}-500`);
            
            msgBox.textContent = message;
            msgBox.style.opacity = 1;
            // 2.5ç§’åæ·¡å‡º
            setTimeout(() => {
                msgBox.style.opacity = 0;
            }, 2500);
        }

        // --- Gemini API Call Function ---
        async function generateMissionStatement() {
            if (isEditMode) return;
            // ... (Gemini API logic remains unchanged)
            const missionStatementDisplay = document.getElementById('mission-statement-display-modal');
            const generateBtn = document.getElementById('generate-mission-btn-modal');
            
            const profileSummary = "æˆ‘æ˜¯ä¸€åçƒ­è¡·äºæ¢ç´¢ Web å‰æ²¿æŠ€æœ¯çš„å¼€å‘è€…ã€‚æ‹¥æœ‰ä¸‰å¹´çš„å‰ç«¯å¼€å‘ç»éªŒï¼Œä¸“æ³¨äºæ„å»ºé«˜æ€§èƒ½ã€ç”¨æˆ·å‹å¥½çš„å“åº”å¼åº”ç”¨ã€‚æˆ‘å¯¹æ•°å­—è‰ºæœ¯å’Œå¹³é¢è®¾è®¡æŠ±æœ‰æµ“åšçš„å…´è¶£ã€‚";
            
            if (!profileSummary) {
                showMessage('ä¸ªäººä»‹ç»å†…å®¹ä¸ºç©ºï¼Œæ— æ³•ç”Ÿæˆä½¿å‘½å®£è¨€ã€‚', 'red');
                return;
            }

            const systemPrompt = "Act as a professional career consultant and PR specialist. Based on the provided candidate profile text, generate a single, highly compelling, 40-word maximum 'Mission Statement' or 'Professional Motto' for the candidate. The tone should be aspirational and professional. Respond ONLY with the generated mission statement text, nothing else. The response MUST be in Chinese.";

            const userQuery = `åŸºäºä»¥ä¸‹ä¸ªäººç®€ä»‹æ–‡æœ¬ï¼Œç”Ÿæˆä¸€ä¸ªä¸è¶…è¿‡40å­—çš„èŒä¸šä½¿å‘½å®£è¨€æˆ–å£å·:\n\n---START OF PROFILE---\n${profileSummary}\n---END OF PROFILE---`;

            generateBtn.disabled = true;
            generateBtn.innerHTML = '<span class="animate-spin mr-2">âŸ³</span> AI æ­£åœ¨åŠªåŠ›æ€è€ƒ...';
            missionStatementDisplay.innerHTML = '<p class="text-base text-indigo-600 text-center">AI æ­£åœ¨æ’°å†™ä¸­...</p>';
            
            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                systemInstruction: { parts: [{ text: systemPrompt }] },
            };

            try {
                const response = await fetchWithRetry(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                
                const result = await response.json();
                const generatedText = result.candidates?.[0]?.content?.parts?.[0]?.text || "æŠ±æ­‰ï¼Œç”Ÿæˆå†…å®¹å¤±è´¥ã€‚";
                
                missionStatementDisplay.innerHTML = `<p class="text-lg font-bold text-gray-800 italic leading-snug">${generatedText}</p>`;
                showMessage('ä½¿å‘½å®£è¨€å·²æˆåŠŸç”Ÿæˆï¼', 'green');

            } catch (error) {
                console.error('Gemini API Error:', error);
                missionStatementDisplay.innerHTML = '<p class="text-base text-red-500 text-center">API è°ƒç”¨å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œå’Œæƒé™ã€‚</p>';
                showMessage('APIè°ƒç”¨å¤±è´¥ã€‚', 'red');

            } finally {
                generateBtn.disabled = false;
                generateBtn.innerHTML = 'âœ¨ è¿è¡Œ AI ç”Ÿæˆ';
            }
        }
        
        // --- Bluetooth Logic Functions ---

        // NEW: Updated to accept connected device name
        function updateBluetoothUI(isOn, isConnected = false, name = connectedDeviceName) {
            const btn = document.getElementById('bluetooth-toggle');
            const text = document.getElementById('bluetooth-status-text');

            btn.classList.remove('bg-indigo-500', 'bg-green-500', 'bg-white/20');
            text.classList.remove('text-white', 'text-gray-300');

            if (isOn) {
                if (isConnected) {
                    // å·²è¿æ¥çŠ¶æ€ (Connected)
                    btn.classList.add('bg-green-500');
                    text.classList.add('text-white');
                    text.textContent = name.substring(0, 10) + (name.length > 10 ? '...' : ''); // Truncate name for status bar
                    
                } else {
                    // å¼€å¯/æœç´¢çŠ¶æ€ (Searching/On)
                    btn.classList.add('bg-indigo-500');
                    text.classList.add('text-white');
                    text.textContent = 'æœç´¢ä¸­...';
                }
            } else {
                // å…³é—­çŠ¶æ€ (Off)
                btn.classList.add('bg-white/20');
                text.classList.add('text-gray-300');
                text.textContent = 'è“ç‰™';
            }
        }

        // Modified handleBluetoothToggle for quick press/toggle
        function handleBluetoothToggle() {
            if (isEditMode) return; 
            
            isBluetoothOn = !isBluetoothOn;
            isBluetoothConnected = false; 
            connectedDeviceName = "My Gemini Headset"; // Reset to default simulated name

            if (isBluetoothOn) {
                // 1. Turn on and search visually (Simulation)
                updateBluetoothUI(true, false);
                showMessage('è“ç‰™å·²å¼€å¯ï¼Œæ­£åœ¨æœç´¢è®¾å¤‡...', 'indigo');

                // 2. Simulate connection after a delay
                setTimeout(() => {
                    if (isBluetoothOn) {
                        isBluetoothConnected = true;
                        updateBluetoothUI(true, true);
                        showMessage(`æˆåŠŸè¿æ¥åˆ° ${connectedDeviceName}ï¼`, 'green');
                    }
                }, 2000); 

            } else {
                // 3. Turn off
                updateBluetoothUI(false, false);
                showMessage('è“ç‰™å·²å…³é—­', 'red');
            }
        }

        // MODIFIED: Reverting to full simulation due to Permissions Policy error
        async function connectRealBluetooth() {
            if (!isBluetoothOn) {
                showMessage('è¯·å…ˆå¼€å¯è“ç‰™ï¼', 'red');
                return false;
            }

            if (isScanning) return; 
            
            const startScanBtn = document.getElementById('start-bluetooth-scan');
            const list = document.getElementById('available-devices-list');

            isScanning = true;
            startScanBtn.disabled = true;
            startScanBtn.innerHTML = '<span class="animate-spin mr-2">âŸ³</span> æ­£åœ¨æ¨¡æ‹Ÿæœç´¢...'; // Change text to simulation

            // Clear previous dynamic search results (keep initial static devices)
            Array.from(list.children).forEach(child => {
                if (!child.classList.contains('initial-device')) {
                    child.remove();
                }
            });

            // --- SIMULATION LOGIC START ---
            setTimeout(() => {
                if (isScanning) {
                    // Simulate finding a new device
                    const simulatedDeviceName = "AirDots Pro";
                    const connectedLi = document.createElement('li');
                    connectedLi.className = 'p-3 bg-green-100 rounded-lg flex justify-between items-center border border-green-300';
                    connectedLi.innerHTML = `
                        <span class="font-medium text-green-800">${simulatedDeviceName} (å·²é…å¯¹)</span>
                        <span class="text-sm text-green-600 font-bold">è¿æ¥</span>
                    `;
                    list.appendChild(connectedLi);
                    
                    showMessage('æ¨¡æ‹Ÿæœç´¢å®Œæ¯•ï¼šå‘ç° AirDots Pro', 'yellow');
                    
                    isScanning = false;
                    startScanBtn.disabled = false;
                    startScanBtn.textContent = 'é‡æ–°æœç´¢';
                    updateBluetoothModalUI(); 
                }
            }, 3000); // 3 second delay for scanning simulation
            // --- SIMULATION LOGIC END ---
        }


        // --- Flashlight Logic Variables ---
        let isFlashlightOn = false;

        function updateFlashlightUI() {
            const btn = document.getElementById('flashlight-toggle');
            const text = document.getElementById('flashlight-status-text');

            btn.classList.remove('bg-yellow-400', 'bg-white/20');
            text.classList.remove('text-white', 'text-gray-300');

            if (isFlashlightOn) {
                // å¼€å¯çŠ¶æ€ (On)
                btn.classList.add('bg-yellow-400'); // äº®é»„è‰²èƒŒæ™¯
                text.classList.add('text-white');
                showMessage('æ‰‹ç”µç­’å·²å¼€å¯', 'green');
            } else {
                // å…³é—­çŠ¶æ€ (Off)
                btn.classList.add('bg-white/20');
                text.classList.add('text-gray-300');
                showMessage('æ‰‹ç”µç­’å·²å…³é—­', 'red');
            }
        }

        function handleFlashlightToggle() {
            if (isEditMode) return; // Disable during edit mode
            isFlashlightOn = !isFlashlightOn;
            updateFlashlightUI();
        }

        // --- Bluetooth Config Modal Logic (Open/Close) ---
        const bluetoothConfigModal = document.getElementById('bluetooth-config-modal');
        const bluetoothModalStatus = document.getElementById('bluetooth-modal-status');
        const headsetStatus = document.getElementById('headset-status');

        // Function to update the Bluetooth Modal UI based on global state
        function updateBluetoothModalUI() {
            bluetoothModalStatus.classList.remove('text-red-500', 'text-indigo-500', 'text-green-500');
            headsetStatus.classList.remove('text-green-600', 'text-gray-500', 'text-indigo-600');

            if (isBluetoothOn) {
                if (isBluetoothConnected) {
                    bluetoothModalStatus.textContent = `å·²è¿æ¥ (${connectedDeviceName})`;
                    bluetoothModalStatus.classList.add('text-green-500');
                    headsetStatus.textContent = 'å·²è¿æ¥';
                    headsetStatus.classList.add('text-green-600');
                } else {
                    bluetoothModalStatus.textContent = 'å¼€å¯ (æœç´¢ä¸­)';
                    bluetoothModalStatus.classList.add('text-indigo-500');
                    headsetStatus.textContent = 'æœªè¿æ¥';
                    headsetStatus.classList.add('text-gray-500');
                }
            } else {
                bluetoothModalStatus.textContent = 'å…³é—­';
                bluetoothModalStatus.classList.add('text-red-500');
                headsetStatus.textContent = 'æœªè¿æ¥';
                headsetStatus.classList.add('text-gray-500');
            }
        }
        
        function closeNotificationCenter() {
            const notificationCenter = document.getElementById('notification-center');
            if (notificationCenter) {
                notificationCenter.style.transition = 'transform 0.25s ease-in-out';
                notificationCenter.style.transform = 'translateY(-100%)';
                showMessage('é€šçŸ¥ä¸­å¿ƒå·²å…³é—­', 'indigo');
            }
        }

        // Function to close the Bluetooth Bottom Sheet (Swipe Up Action)
        function closeBluetoothConfig() {
            bluetoothConfigModal.classList.remove('is-open');
            bluetoothConfigModal.style.transform = ''; 
            showMessage('è“ç‰™é…ç½®å·²å…³é—­', 'indigo');
        }

        // Function to open the Bluetooth Bottom Sheet (Long Press Action)
        function openBluetoothConfig() {
            if (isEditMode) return; // Disable during edit mode
            
            const lockScreen = document.getElementById('lock-screen');
            const notificationCenter = document.getElementById('notification-center');

            if (lockScreen.style.display !== 'none') return;
            
            // Close notification center if open
            if (parseFloat(notificationCenter.style.transform.match(/(-?\d+(\.\d+)?)/)?.[0] || -100) > -100) {
                 closeNotificationCenter(); 
            }
            
            // Update modal status before opening
            updateBluetoothModalUI();

            // Wait for notif center to close (0.25s transition)
            setTimeout(() => {
                bluetoothConfigModal.classList.add('is-open');
                showMessage('è“ç‰™å¿«é€Ÿé…ç½®å·²æ‰“å¼€', 'indigo');
            }, 250); // Adjusted timing

            // Ensure transition is reset for smooth opening (in case it was manually dragged before)
            bluetoothConfigModal.style.transition = 'transform 0.25s ease-in-out';
        }

        // --- Notification Clear Logic ---
        function handleClearAllNotifications() {
            if (isEditMode) return; // Disable during edit mode
            
            const activeNotifs = document.getElementById('active-notifications');
            const noNotifsMsg = document.getElementById('no-notifications-message');
            const clearBtn = document.getElementById('clear-all-notifications');

            // Hide all active notifications
            activeNotifs.innerHTML = ''; // Clear content
            activeNotifs.classList.add('hidden');
            
            // Show "No more notifications" message
            noNotifsMsg.classList.remove('hidden');
            
            // Hide the clear button since there's nothing to clear
            clearBtn.classList.add('hidden');
            
            showMessage('å…¨éƒ¨é€šçŸ¥å·²æ¸…é™¤', 'yellow');
        }
        
        // --- App Modal Control (Generic) ---

        /**
         * Opens an application modal.
         * @param {string} modalId - The ID of the modal element (e.g., 'message-app-modal').
         * @param {string} appName - The display name of the app (e.g., 'æ¶ˆæ¯').
         */
        function openApp(modalId, appName) {
            if (isEditMode) return; // Disable during edit mode
            
            const modalElement = document.getElementById(modalId);
            const lockScreen = document.getElementById('lock-screen');
            const notificationCenter = document.getElementById('notification-center');

            if (lockScreen.style.display !== 'none' || !modalElement) return;

            // Close notification center if open
            if (parseFloat(notificationCenter.style.transform.match(/(-?\d+(\.\d+)?)/)?.[0] || -100) > -100) {
                closeNotificationCenter();
            }

            setTimeout(() => {
                modalElement.classList.add('is-open');
                // Ensure transition is reset for smooth opening (in case it was manually dragged before)
                modalElement.style.transition = 'transform 0.25s ease-in-out';
                showMessage(`${appName} åº”ç”¨å·²å¯åŠ¨`, 'indigo');
            }, 250); 
        }

        /**
         * Closes an application modal.
         * @param {string} modalId - The ID of the modal element.
         * @param {string} appName - The display name of the app.
         */
        function closeApp(modalId, appName) {
            const modalElement = document.getElementById(modalId);
            if (modalElement) {
                modalElement.classList.remove('is-open');
                modalElement.style.transform = ''; // Reset transform
                showMessage(`è¿”å›ä¸»å±å¹•`, 'indigo');
            }
        }
        
        // --- Core Application Logic ---
        document.addEventListener('DOMContentLoaded', () => {
            const lockScreen = document.getElementById('lock-screen');
            const mainContent = document.getElementById('main-content');
            const innerScreen = document.getElementById('inner-screen');
            
            // Notification Center Elements
            const notificationCenter = document.getElementById('notification-center');
            const notifHomeIndicator = document.getElementById('notif-home-indicator');
            const bluetoothToggle = document.getElementById('bluetooth-toggle');
            const flashlightToggle = document.getElementById('flashlight-toggle'); 
            const brightnessContainer = document.getElementById('brightness-container'); 
            const clearAllBtn = document.getElementById('clear-all-notifications'); // Get clear button
            const startScanBtn = document.getElementById('start-bluetooth-scan'); // Get new scan button
            
            // --- Utility to toggle Edit Mode ---
            function toggleEditMode(enable) {
                const appIcons = document.querySelectorAll('.app-icon-btn');
                const dockIcons = document.querySelectorAll('.dock-icon-btn');
                const dockContainer = document.querySelector('.flex-shrink-0.h-16.bg-white\\/30.backdrop-blur-md');

                if (enable) {
                    if (isEditMode) return;
                    isEditMode = true;
                    // 1. Jiggle Icons
                    appIcons.forEach(icon => {
                        icon.classList.add('jiggle');
                        icon.disabled = true; // Disable default click
                    });
                    // 2. Lock Docks/Widget (Optional, mostly visual)
                    dockIcons.forEach(icon => {
                        icon.disabled = true;
                    });
                    dockContainer.classList.add('grayscale', 'opacity-70');
                    showMessage('è¿›å…¥ç¼–è¾‘æ¨¡å¼ï¼šè½»è§¦é€€å‡º', 'yellow');
                } else {
                    if (!isEditMode) return;
                    isEditMode = false;
                    // 1. Stop Jiggle
                    appIcons.forEach(icon => {
                        icon.classList.remove('jiggle');
                        icon.disabled = false; // Re-enable default click
                    });
                    // 2. Unlock Docks/Widget
                    dockIcons.forEach(icon => {
                        icon.disabled = false;
                    });
                    dockContainer.classList.remove('grayscale', 'opacity-70');
                    showMessage('é€€å‡ºç¼–è¾‘æ¨¡å¼', 'indigo');
                }
            }


            // --- Event Listeners ---
            flashlightToggle.addEventListener('click', handleFlashlightToggle); 
            clearAllBtn.addEventListener('click', handleClearAllNotifications); 
            // MODIFIED: Bind startScanBtn to the new Web Bluetooth logic
            startScanBtn.addEventListener('click', connectRealBluetooth); 

            // 1. App Icon Click Listeners
            document.getElementById('message-app-icon').addEventListener('click', () => { openApp('message-app-modal', 'æ¶ˆæ¯'); });
            document.getElementById('gallery-app-icon').addEventListener('click', () => { openApp('gallery-app-modal', 'ç›¸å†Œ'); });
            document.getElementById('settings-app-icon').addEventListener('click', () => { openApp('settings-app-modal', 'è®¾ç½®'); });
            document.getElementById('browser-app-icon').addEventListener('click', () => { openApp('browser-app-modal', 'æµè§ˆå™¨'); });
            document.getElementById('music-app-icon').addEventListener('click', () => { openApp('music-app-modal', 'éŸ³ä¹'); });
            document.getElementById('ai-app-icon').addEventListener('click', () => { openApp('ai-app-modal', 'AI å®£è¨€'); });
            
            // NEW APP LISTENERS
            document.getElementById('x-app-icon').addEventListener('click', () => { openApp('x-app-modal', 'X (æ¨ç‰¹)'); });
            document.getElementById('xhs-app-icon').addEventListener('click', () => { openApp('xhs-app-modal', 'å°çº¢ä¹¦'); });
            document.getElementById('ins-app-icon').addEventListener('click', () => { openApp('ins-app-modal', 'Instagram'); });
            document.getElementById('taobao-app-icon').addEventListener('click', () => { openApp('taobao-app-modal', 'æ·˜å®'); });
            document.getElementById('tieba-app-icon').addEventListener('click', () => { openApp('tieba-app-modal', 'è´´å§'); });
            document.getElementById('map-app-icon').addEventListener('click', () => { openApp('map-app-modal', 'åœ°å›¾'); });
            document.getElementById('live-app-icon').addEventListener('click', () => { openApp('live-app-modal', 'ç›´æ’­'); });
            document.getElementById('weibo-app-icon').addEventListener('click', () => { openApp('weibo-app-modal', 'å¾®åš'); });
            document.getElementById('memo-app-icon').addEventListener('click', () => { openApp('memo-app-modal', 'å¤‡å¿˜å½•'); });
            document.getElementById('theme-app-icon').addEventListener('click', () => { openApp('theme-app-modal', 'ä¸»é¢˜'); });


            // 2. App Close Button Listeners (Using delegation for consistency)
            document.querySelectorAll('.close-app-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const modalId = e.currentTarget.getAttribute('data-app-id');
                    const appName = e.currentTarget.getAttribute('data-app-name');
                    closeApp(modalId, appName);
                });
            });
            
            // 3. AI App Specific Listener
            document.getElementById('generate-mission-btn-modal').addEventListener('click', generateMissionStatement);

            // --- Status Bar Logic from User Input ---

            /* ========== æ—¶é—´åŒæ­¥ - MODIFIED for Widget/Notif Sync ========== */
            function updateClock() {
                const now = new Date();
                const h = String(now.getHours()).padStart(2, "0");
                const m = String(now.getMinutes()).padStart(2, "0");
                
                // 1. New Status Bar Time
                const statusTimeEl = document.querySelector(".status-time");
                if (statusTimeEl) statusTimeEl.textContent = `${h}:${m}`;

                // 2. Widget Time/Date Synchronization
                const widgetTimeElement = document.getElementById('widget-time');
                const widgetDateElement = document.getElementById('widget-date');
                const notificationDate = document.getElementById('notification-date');
                
                if (widgetTimeElement) widgetTimeElement.textContent = `${h}:${m}`;
                if (widgetDateElement) widgetDateElement.textContent = now.toLocaleDateString('zh-CN', { weekday: 'short', month: 'long', day: 'numeric' });
                
                // 3. Notification Center Date Synchronization
                const options = { month: 'long', day: 'numeric', weekday: 'long' };
                if (notificationDate) notificationDate.textContent = now.toLocaleDateString('zh-CN', options);
            }
            setInterval(updateClock, 1000);
            updateClock();

            /* ========== å¤©æ°” - MODIFIED for Widget Sync and Beijing Fallback ========== */
            // Helper to convert WMO code to description (simplified)
            function getWeatherCondition(code) {
                if (code >= 80) return 'é˜µé›¨';
                if (code >= 71) return 'ä¸‹é›ª';
                if (code >= 61) return 'é™é›¨';
                if (code >= 51) return 'ç»†é›¨';
                if (code >= 45) return 'æœ‰é›¾';
                if (code >= 3) return 'å¤šäº‘';
                if (code >= 1) return 'æ™´æœ—';
                return 'æœªçŸ¥';
            }
            
            // Beijing Coordinates for fallback
            const BEIJING_LAT = 39.9042;
            const BEIJING_LON = 116.4074;

            async function updateWeather(lat, lon) {
                const statusWeatherEl = document.querySelector(".status-weather");
                const widgetTempEl = document.getElementById('widget-temp-display');
                const widgetLocationEl = document.getElementById('widget-location-display');

                if (!statusWeatherEl || !widgetTempEl || !widgetLocationEl) return;
                
                try {
                    const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true`;
                    const res = await fetch(url);
                    const data = await res.json();
                    
                    const temp = Math.round(data.current_weather.temperature);
                    const weatherCode = data.current_weather.weathercode;
                    const condition = getWeatherCondition(weatherCode);

                    // 1. Status Bar Update
                    statusWeatherEl.textContent = `${temp}Â°C`;

                    // 2. Widget Update
                    widgetTempEl.textContent = `${temp}Â°C`;
                    // Simplified: Show condition and approximate location based on coordinates
                    // Check for default Beijing coordinates
                    const isBeijingFallback = (Math.abs(lat - BEIJING_LAT) < 0.01 && Math.abs(lon - BEIJING_LON) < 0.01);
                    const locationText = isBeijingFallback ? 'åŒ—äº¬' : 'å®šä½ä½ç½®';
                    widgetLocationEl.textContent = `${condition}, ${locationText}`;

                } catch (err) {
                    console.warn("Weather fetch failed:", err);
                    statusWeatherEl.textContent = "N/A";
                    widgetTempEl.textContent = "N/A";
                    widgetLocationEl.textContent = "æ— æ³•è·å–ä½ç½®";
                }
            }

            // è‡ªåŠ¨å®šä½æˆ–é»˜è®¤åŒ—äº¬
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (pos) => {
                        updateWeather(pos.coords.latitude, pos.coords.longitude);
                    },
                    () => updateWeather(BEIJING_LAT, BEIJING_LON) // fallback: Beijing
                );
            } else {
                updateWeather(BEIJING_LAT, BEIJING_LON);
            }

            /* ========== ç½‘ç»œçŠ¶æ€ ========== */
            function updateNetwork() {
                const el = document.querySelector(".status-network");
                if (!el) return;

                const conn = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
                if (!conn) {
                    el.textContent = navigator.onLine ? "WiFi" : "OFFLINE";
                    return;
                }
                const type = conn.effectiveType || "unknown";
                const map = {
                    slow2g: "2G",
                    "2g": "2G",
                    "3g": "3G",
                    "4g": "4G",
                    "5g": "5G",
                };
                el.textContent = map[type] || "WiFi";
            }
            window.addEventListener("online", updateNetwork);
            window.addEventListener("offline", updateNetwork);
            (navigator.connection || {}).addEventListener?.("change", updateNetwork);
            updateNetwork();

            /* ========== ç”µé‡çŠ¶æ€ ========== */
            async function updateBattery() {
                const el = document.querySelector(".status-battery");
                if (!el) return;

                try {
                    const battery = await navigator.getBattery();
                    const refresh = () => {
                        el.textContent = `${Math.round(battery.level * 100)}%`;
                    };
                    refresh();
                    battery.addEventListener("levelchange", refresh);
                } catch {
                    // æ¨¡æ‹Ÿç”µé‡å˜åŒ–
                    let level = 100;
                    const refreshSimulated = () => {
                        level = Math.max(0, level - Math.random() * 3);
                        if (level < 20) level = 100;
                        el.textContent = `${Math.round(level)}%`;
                    };
                    refreshSimulated();
                    setInterval(refreshSimulated, 8000);
                }
            }
            updateBattery();

            // --- End Status Bar Logic ---


            // --- Global Unlock Function (Called by the new slider) ---
            function unlockScreen() {
                lockScreen.style.transition = 'transform 0.5s ease-out';
                lockScreen.style.transform = 'translateY(-100%)';
                mainContent.style.transform = 'scale(1)';
                mainContent.style.filter = 'blur(0)';

                setTimeout(() => {
                    lockScreen.style.display = 'none';
                    lockScreen.style.removeProperty('transform'); 
                    lockScreen.style.removeProperty('transition');
                    showMessage('å±å¹•å·²è§£é”ï¼', 'green');
                }, 500);
            }
            
            // --- Horizontal Slide-to-Unlock Logic ---
            const unlockArea = document.getElementById("unlockArea");
            const unlockHandle = document.getElementById("unlockHandle");
            const max = unlockArea.offsetWidth - unlockHandle.offsetWidth;
            let startX = 0, currentX = 0, dragging = false;

            const getX = (e) => e.touches ? e.touches[0].clientX : e.clientX;

            const start = (e) => {
                if (lockScreen.style.display === 'none') return;
                
                const clientX = getX(e);
                startX = clientX - currentX; 
                dragging = true;
                unlockHandle.style.transition = "none";
                
                if (e.type === 'touchstart') {
                    e.preventDefault();
                }
            };

            const move = (e) => {
                if (!dragging) return;
                const clientX = getX(e);
                currentX = clientX - startX;
                currentX = Math.max(0, Math.min(currentX, max));
                unlockHandle.style.left = `${currentX}px`;
            };

            const end = () => {
                if (!dragging) return;
                dragging = false;

                if (currentX >= max * 0.95) {
                    unlockHandle.style.left = `${max}px`;
                    unlockHandle.style.transition = "left 0.3s ease";
                    unlockScreen();
                } else {
                    unlockHandle.style.left = "0px";
                    unlockHandle.style.transition = "left 0.3s ease";
                    currentX = 0;
                }
            };
            
            unlockArea.addEventListener("mousedown", start);
            document.addEventListener("mousemove", move);
            document.addEventListener("mouseup", end);
            unlockArea.addEventListener("touchstart", start, { passive: false });
            document.addEventListener("touchmove", move, { passive: false });
            document.addEventListener("touchend", end);
            
            // --- Unified Swipe Logic Variables (Remaining) ---
            let dragStartY = 0;
            let isNotifSwiping = false; // Vertical drag state for Notification Center
            let isAppSwiping = false; // Vertical drag state for App/Modal
            let activeSwipeModal = null; 
            
            const notifThreshold = 50;  // å‘ä¸‹æ»‘åŠ¨è¶…è¿‡ 50 åƒç´ æ‰“å¼€é€šçŸ¥ä¸­å¿ƒ
            const topSwipeZone = 50; // è§¦æ‘¸å¼€å§‹äºé¡¶éƒ¨ 50px åŒºåŸŸ
            const homeSwipeThreshold = 50; // ä¸Šæ»‘è¿”å›ä¸»å±å¹•çš„é˜ˆå€¼ (App/Notif Center/Bottom Sheet)
            
            // --- Icon Long Press / Edit Mode Logic (NEW) ---
            let homePressTimer = null;
            
            // --- Utility to toggle Edit Mode ---
            function toggleEditMode(enable) {
                const appIcons = document.querySelectorAll('.app-icon-btn');
                const dockIcons = document.querySelectorAll('.dock-icon-btn');
                const dockContainer = document.querySelector('.flex-shrink-0.h-16.bg-white\\/30.backdrop-blur-md');

                if (enable) {
                    if (isEditMode) return;
                    isEditMode = true;
                    // 1. Jiggle Icons
                    appIcons.forEach(icon => {
                        icon.classList.add('jiggle');
                        icon.disabled = true; // Disable default click
                    });
                    // 2. Lock Docks/Widget (Optional, mostly visual)
                    dockIcons.forEach(icon => {
                        icon.disabled = true;
                    });
                    dockContainer.classList.add('grayscale', 'opacity-70');
                    showMessage('è¿›å…¥ç¼–è¾‘æ¨¡å¼ï¼šè½»è§¦é€€å‡º', 'yellow');
                } else {
                    if (!isEditMode) return;
                    isEditMode = false;
                    // 1. Stop Jiggle
                    appIcons.forEach(icon => {
                        icon.classList.remove('jiggle');
                        icon.disabled = false; // Re-enable default click
                    });
                    // 2. Unlock Docks/Widget
                    dockIcons.forEach(icon => {
                        icon.disabled = false;
                    });
                    dockContainer.classList.remove('grayscale', 'opacity-70');
                    showMessage('é€€å‡ºç¼–è¾‘æ¨¡å¼', 'indigo');
                }
            }
            
            function startHomePress(e) {
                if (lockScreen.style.display !== 'none' || isNotifSwiping || isAppSwiping) return;
                
                const clientX = e.clientX || e.touches?.[0]?.clientX || 0;
                const clientY = e.clientY || e.touches?.[0]?.clientY || 0;
                startPressX = clientX;
                startPressY = clientY;
                
                // Don't start long press if interacting with Dock or Widget
                if (e.target.closest('#time-weather-widget') || e.target.closest('.dock-icon-btn')) {
                    return;
                }

                // If currently in edit mode, don't restart the timer unless we're performing a drag (not fully implemented)
                if (isEditMode) return;
                
                if (homePressTimer !== null) {
                    clearTimeout(homePressTimer);
                }
                
                homePressTimer = setTimeout(() => {
                    homePressTimer = null;
                    toggleEditMode(true);
                }, HOME_LONG_PRESS_DURATION);

                // Prevent default scrolling only if touch starts
                if (e.type === 'touchstart') {
                    // e.preventDefault(); // Handled later conditionally, but this is fine for initial touch
                }
            }

            function endHomePress(e) {
                if (homePressTimer) {
                    clearTimeout(homePressTimer);
                    homePressTimer = null;
                }
                
                // Logic to EXIT Edit Mode on short tap/click
                if (isEditMode) {
                    const endX = e.clientX || e.changedTouches?.[0]?.clientX || startPressX;
                    const endY = e.clientY || e.changedTouches?.[0]?.clientY || startPressY;
                    const deltaY = Math.abs(startPressY - endY);
                    const deltaX = Math.abs(startPressX - endX);

                    // Check if it was a quick tap/release (delta < 10px) on empty space to exit
                    // AND not on an app icon (if we click an icon in edit mode, it doesn't launch, but it should exit)
                    if (deltaY < 10 && deltaX < 10) {
                         // Only exit if the target is NOT a draggable icon (to prevent immediate exit when starting drag)
                        if (!e.target.closest('.app-icon-btn')) {
                             toggleEditMode(false);
                        }
                    }
                }
            }

            function cancelHomePress(e) {
                // If we move too much, cancel the long press timer
                const currentX = e.clientX || e.touches?.[0]?.clientX || startPressX;
                const currentY = e.clientY || e.touches?.[0]?.clientY || startPressY;
                
                const deltaY = Math.abs(startPressY - currentY);
                const deltaX = Math.abs(startPressX - currentX);
                
                if (homePressTimer !== null && (deltaY > 10 || deltaX > 10)) { 
                    clearTimeout(homePressTimer);
                    homePressTimer = null;
                }
                
                // If in edit mode, prevent vertical scrolling
                if (isEditMode && e.type.startsWith('touch')) {
                    e.preventDefault();
                }
            }

            // Bind Home Press listeners
            innerScreen.addEventListener('mousedown', startHomePress);
            innerScreen.addEventListener('touchstart', startHomePress);
            document.addEventListener('mouseup', endHomePress);
            document.addEventListener('touchend', endHomePress);
            innerScreen.addEventListener('mousemove', cancelHomePress);
            innerScreen.addEventListener('touchmove', cancelHomePress);
            
            // --- Long Press Logic for Bluetooth Toggle (Adjusted for new var names) ---
            function startPress(e) {
                if (isEditMode) return; // Disable during edit mode
                
                dragStartX = e.clientX || e.touches?.[0]?.clientX || 0;
                dragStartY = e.clientY || e.touches?.[0]?.clientY || 0;
                
                if (pressTimer !== null) {
                    clearTimeout(pressTimer);
                }
                if (e.target.closest('#bluetooth-toggle')) {
                    if (e.type === 'touchstart') {
                        e.preventDefault();
                    }
                    pressTimer = setTimeout(() => {
                        pressTimer = null;
                        openBluetoothConfig(); 
                    }, LONG_PRESS_DURATION);
                }
            }

            function endPress(e) {
                if (pressTimer) {
                    clearTimeout(pressTimer);
                    pressTimer = null;
                    
                    if (e.target.closest('#bluetooth-toggle')) {
                        const endX = e.clientX || e.changedTouches?.[0]?.clientX || dragStartX;
                        const endY = e.clientY || e.changedTouches?.[0]?.clientY || dragStartY;
                        
                        const deltaY = Math.abs(dragStartY - endY);
                        const deltaX = Math.abs(dragStartX - endX);
                        
                        if (deltaY < 5 && deltaX < 5) { 
                             handleBluetoothToggle();
                        }
                    }
                }
            }

            // Combined cancelPress for Bluetooth with general checks
            function cancelBluetoothPress(e) {
                 const deltaY = Math.abs(dragStartY - (e.clientY || e.touches?.[0]?.clientY || dragStartY));
                 const deltaX = Math.abs(dragStartX - (e.clientX || e.touches?.[0]?.clientX || dragStartX));

                if (pressTimer !== null && (deltaY > 10 || deltaX > 10)) { 
                    clearTimeout(pressTimer);
                    pressTimer = null;
                }
            }

            bluetoothToggle.addEventListener('mousedown', startPress);
            bluetoothToggle.addEventListener('touchstart', startPress, { passive: false });
            document.addEventListener('mouseup', endPress);
            document.addEventListener('touchend', endPress);
            document.addEventListener('mousemove', cancelBluetoothPress);
            document.addEventListener('touchmove', cancelBluetoothPress);
            
            // --- Notification Center Handlers (Swipe Down/Up) ---
            notifHomeIndicator.addEventListener('click', closeNotificationCenter);

            function handleNotifStart(y) {
                if (isEditMode) return; // Disable swipe in edit mode
                dragStartY = y;
                isNotifSwiping = true;
                notificationCenter.style.transition = 'none'; 
            }

            function handleNotifMove(y) {
                if (!isNotifSwiping) return;

                const deltaY = y - dragStartY; // å‘ä¸‹æ»‘åŠ¨æ—¶ deltaY > 0
                const currentNotifY = parseFloat(notificationCenter.style.transform.match(/(-?\d+(\.\d+)?)/)?.[0] || 0);
                
                const innerScreenRect = innerScreen.getBoundingClientRect();
                if (y < innerScreenRect.top || y > innerScreenRect.bottom) return;

                if (currentNotifY === 0) {
                    if (deltaY < 0) {
                        notificationCenter.style.transform = `translateY(${deltaY}px)`;
                    } else {
                        notificationCenter.style.transform = 'translateY(0)';
                    }
                } else if (currentNotifY < 0) {
                    if (deltaY > 0) {
                        const offset = Math.min(deltaY, notificationCenter.offsetHeight);
                        notificationCenter.style.transform = `translateY(${offset - notificationCenter.offsetHeight}px)`;
                    } else {
                        notificationCenter.style.transform = 'translateY(-100%)';
                    }
                }
            }

            function handleNotifEnd(y) {
                if (!isNotifSwiping) return;
                isNotifSwiping = false;

                notificationCenter.style.transition = 'transform 0.25s ease-in-out';
                
                const currentY = parseFloat(notificationCenter.style.transform.match(/(-?\d+(\.\d+)?)/)?.[0] || 0);
                const deltaY = y - dragStartY;

                if (currentY >= -notifThreshold) {
                    notificationCenter.style.transform = 'translateY(0)';
                    showMessage('é€šçŸ¥ä¸­å¿ƒå·²æ‰“å¼€', 'indigo');
                } else if (currentY < -notificationCenter.offsetHeight + notifThreshold && deltaY < 0) {
                    closeNotificationCenter();
                } else {
                    if (currentY > -notificationCenter.offsetHeight / 2) {
                        notificationCenter.style.transform = 'translateY(0)';
                    } else {
                        closeNotificationCenter();
                    }
                }
            }

            // --- App Modal Swipe Handlers (Swipe Up to Close) ---
            function handleAppStart(y, modalElement) {
                if (isEditMode) return; // Disable swipe in edit mode
                dragStartY = y;
                isAppSwiping = true;
                activeSwipeModal = modalElement;
                activeSwipeModal.style.transition = 'none'; 
            }

            function handleAppMove(y) {
                if (!isAppSwiping || !activeSwipeModal) return;

                const dragDistance = y - dragStartY; 
                
                if (dragDistance < 0) {
                    const newY = Math.max(-activeSwipeModal.offsetHeight, dragDistance); 
                    activeSwipeModal.style.transform = `translateY(${newY}px)`;
                } else {
                    activeSwipeModal.style.transform = 'translateY(0)';
                }
            }

            function handleAppEnd(y) {
                if (!isAppSwiping || !activeSwipeModal) return;
                isAppSwiping = false;

                activeSwipeModal.style.transition = 'transform 0.25s ease-in-out';
                
                const dragDistance = y - dragStartY;
                
                if (dragDistance < -homeSwipeThreshold) {
                    const modalId = activeSwipeModal.id;
                    if (modalId === 'ai-app-modal') closeApp(modalId, 'AI å®£è¨€');
                    else if (modalId === 'message-app-modal') closeApp(modalId, 'æ¶ˆæ¯');
                    else if (modalId === 'gallery-app-modal') closeApp(modalId, 'ç›¸å†Œ');
                    else if (modalId === 'settings-app-modal') closeApp(modalId, 'è®¾ç½®');
                    else if (modalId === 'browser-app-modal') closeApp(modalId, 'æµè§ˆå™¨');
                    else if (modalId === 'music-app-modal') closeApp(modalId, 'éŸ³ä¹');
                    else if (modalId === 'x-app-modal') closeApp(modalId, 'X (æ¨ç‰¹)');
                    else if (modalId === 'xhs-app-modal') closeApp(modalId, 'å°çº¢ä¹¦');
                    else if (modalId === 'ins-app-modal') closeApp(modalId, 'Instagram');
                    else if (modalId === 'taobao-app-modal') closeApp(modalId, 'æ·˜å®');
                    else if (modalId === 'tieba-app-modal') closeApp(modalId, 'è´´å§');
                    else if (modalId === 'map-app-modal') closeApp(modalId, 'åœ°å›¾');
                    else if (modalId === 'live-app-modal') closeApp(modalId, 'ç›´æ’­');
                    else if (modalId === 'weibo-app-modal') closeApp(modalId, 'å¾®åš');
                    else if (modalId === 'memo-app-modal') closeApp(modalId, 'å¤‡å¿˜å½•');
                    else if (modalId === 'theme-app-modal') closeApp(modalId, 'ä¸»é¢˜');
                    else if (modalId === 'bluetooth-config-modal') closeBluetoothConfig();
                    
                } else {
                    activeSwipeModal.style.transform = 'translateY(0)';
                }
                activeSwipeModal = null;
            }


            // --- Global Touch/Mouse Dispatcher ---

            innerScreen.addEventListener('touchstart', (e) => {
                const clientY = e.touches[0].clientY;
                const innerScreenRect = innerScreen.getBoundingClientRect();
                const touchRelativeY = clientY - innerScreenRect.top;
                
                const isLocked = lockScreen.style.display !== 'none';
                
                // Identify which modal is active
                const activeModal = Array.from(document.querySelectorAll('.app-modal, #bluetooth-config-modal'))
                    .find(modal => modal.classList.contains('is-open'));

                const isNotifFullyOpen = parseFloat(notificationCenter.style.transform.match(/(-?\d+(\.\d+)?)/)?.[0] || 0) === 0;

                // 1. Horizontal Unlock: Already handled by listeners on unlockArea
                if (isLocked) {
                    return; 
                }
                
                // 2. App/Modal Swipe
                if (activeModal) { 
                    handleAppStart(clientY, activeModal); 
                    return;
                }
                
                // 3. Notification Swipe (Only runs if no App Modal is open)
                if (!activeModal && !isLocked) {
                    // Check if it's drag down from top OR drag up from full open state
                    if (touchRelativeY < topSwipeZone || isNotifFullyOpen) {
                        
                        // Check if the touch starts on the brightness slider/container
                        if (e.target.closest('#brightness-container') && isNotifFullyOpen) {
                            return; 
                        }

                        // Ignore clicks on actionable items for drag start detection
                        if (e.target.closest('.app-icon-btn, .dock-icon-btn, .toggle-btn')) return;
                        
                        handleNotifStart(clientY);
                        return;
                    }
                }
            }, { passive: false });

            // Global Move/End listeners are needed on the whole screen for a smooth drag
            document.addEventListener('touchmove', (e) => {
                // Prevent Default is CONDITIONAL
                if (isNotifSwiping || isAppSwiping || dragging) {
                     e.preventDefault(); 
                }
                // NEW: Prevent native scrolling if in Edit Mode
                if (isEditMode && e.target.closest('#main-content')) {
                    e.preventDefault();
                }

                if (isNotifSwiping) {
                    handleNotifMove(e.touches[0].clientY);
                } else if (isAppSwiping) { 
                    handleAppMove(e.touches[0].clientY);
                }
            }, { passive: false });


            document.addEventListener('touchend', (e) => { 
                if (isNotifSwiping) {
                    handleNotifEnd(e.changedTouches[0].clientY); 
                } else if (isAppSwiping) { 
                    handleAppEnd(e.changedTouches[0].clientY);
                }
            });


            // Mouse event delegation (simple version, only for inner screen bounds)
            document.addEventListener('mousedown', (e) => {
                const innerScreenRect = innerScreen.getBoundingClientRect();
                if (e.clientY < innerScreenRect.top || e.clientY > innerScreenRect.bottom || 
                    e.clientX < innerScreenRect.left || e.clientX > innerScreenRect.right) return;

                const touchRelativeY = e.clientY - innerScreenRect.top;
                const isLocked = lockScreen.style.display !== 'none';
                
                const activeModal = Array.from(document.querySelectorAll('.app-modal, #bluetooth-config-modal'))
                    .find(modal => modal.classList.contains('is-open'));

                const isNotifFullyOpen = parseFloat(notificationCenter.style.transform.match(/(-?\d+(\.\d+)?)/)?.[0] || 0) === 0;

                // Horizontal slider handles lock screen start
                
                if (activeModal) { 
                    handleAppStart(e.clientY, activeModal);
                } else if (!activeModal && !isLocked && (touchRelativeY < topSwipeZone || isNotifFullyOpen)) {
                    // Ignore clicks on actionable items
                    if (e.target.closest('.app-icon-btn, .dock-icon-btn, .toggle-btn')) return;
                    
                    // Allow native brightness slider interaction (desktop mouse drag)
                    if (e.target.closest('#brightness-container')) {
                        return; 
                    }

                    handleNotifStart(e.clientY);
                }
            });

            document.addEventListener('mousemove', (e) => { 
                if (isNotifSwiping) {
                    handleNotifMove(e.clientY); 
                } else if (isAppSwiping) { 
                    handleAppMove(e.clientY);
                }
            });
            
            document.addEventListener('mouseup', (e) => { 
                if (isNotifSwiping) {
                    handleNotifEnd(e.clientY); 
                } else if (isAppSwiping) { 
                    handleAppEnd(e.clientY);
                }
            });
            
            document.addEventListener('mouseleave', (e) => { 
                if (isNotifSwiping) {
                    handleNotifEnd(dragStartY + 1); 
                } else if (isAppSwiping) {
                    handleAppEnd(dragStartY + 1);
                }
            });

        });
    </script>
</body>
</html>
